<div class="card w-100" style="width: 100%">
  <div class="card-header d-flex align-items-center" (click)="goToUser()" style="cursor: pointer">
    <img [src]="avatar" alt="User Avatar" class="rounded-circle me-2" width="40" height="40" />
    <div>
      <h6 class="mb-0">{{ username }}</h6>

      <small class="text-muted">{{ date | timeAgo }}</small>
    </div>
    <div class="ms-auto d-flex gap-2">
      <button *ngIf="post.mine" class="btn btn-sm btn-outline-secondary" (click)="editPost(); $event.stopPropagation()"
        title="Edit">
        <i class="fa fa-pen"></i>
      </button>

      <button *ngIf="post.mine" class="btn btn-sm btn-outline-danger" (click)="deletePost(); $event.stopPropagation()"
        title="Delete">
        <i class="fa fa-trash"></i>
      </button>
    </div>

  </div>
  <div *ngIf="!desc && post.fileUrl.length > 0" id="carouselExample" class="carousel slide p-5">
    <div class="carousel-inner">
      <div class="carousel-item" *ngFor="let url of post.fileUrl; let i = index" [class.active]="i === 0">
        <!-- video -->
        <video *ngIf="isVideo(url)" class="d-block w-100" controls>
          <source [src]="url" />
          Your browser does not support video.
        </video>

        <!-- image -->
        <img *ngIf="isImage(url)" [src]="url" class="d-block w-100" alt="Post image" />
      </div>
    </div>

    <button *ngIf="post.fileUrl.length > 1" class="carousel-control-prev small-carousel-btn center-carousel-btn"
      type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
      <span class="carousel-control-prev-icon"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button *ngIf="post.fileUrl.length > 1" class="carousel-control-next small-carousel-btn center-carousel-btn"
      type="button" data-bs-target="#carouselExample" data-bs-slide="next">
      <span class="carousel-control-next-icon"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>

  <div class="card-body" (click)="goToPost()" style="cursor: pointer">
    <markdown [data]="desc ? post.description : post.content"></markdown>
  </div>
  <div class="card-body d-flex align-items-center">
    <img width="24" height="24" (click)="likePost()"
      [src]="post.likedByCurrentUser ? '/media/liked-icon.png' : '/media/like-icon.png'" style="cursor: pointer" />
    <span class="ms-2">{{ likesCount }}</span>
    <div class="mx-auto">
      <img width="24" height="24" src="/media/comment-icon.png" (click)="goToPost()" style="cursor: pointer" />
      <span class="mx-1">{{ comments.length }}</span>
    </div>
    <img width="24" height="24" src="/media/alert-icon.png" (click)="openReportModal()" />
    <span class="mx-1">0</span>
  </div>
</div>

<app-report [visible]="showReportModal" [id]="post.id" [user]="false" (closed)="showReportModal = false"
  (reported)="handleReport($event)">
</app-report>

<app-dialog [visible]="showDialogMessage" [message]="dialogMessage" [title]="dialogTitle"
  (closed)="onClosedDialog()"></app-dialog>

<app-create-post [visible]="showEditModal" [edit]="true" [postId]="post.id" [content]="editContent"
  [description]="editDescription" [existingFiles]="editFiles" (closed)="showEditModal = false"
  (saved)="onSavedEdit()"></app-create-post>