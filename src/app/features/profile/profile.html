<app-header></app-header>

<div class="headerplace container mt-10">
  <div class="row g-4">
    <div class="col-md-3">
      <div class="card shadow-sm border-0 profile-card">
        <div *ngIf="user; else noUser" class="card-body text-center">
          <div class="avatar-wrapper mb-3">
            <img class="avatar-img" [src]="user.avatar || 'https://bootdey.com/img/Content/avatar/avatar5.png'"
              alt="avatar" />
          </div>

          <h5 class="fw-bold mb-0">{{ user.username }}</h5>
          <span class="badge bg-secondary mb-2">{{ user.role }}</span>

          <p class="text-muted small mb-1">{{ user.email }}</p>
          <p class="text-muted small">Joined {{ user.CDate | timeAgo }}</p>

          <div class="d-flex justify-content-around my-3 stats">
            <div>
              <strong>{{ user.followersCount }}</strong>
              <div class="text-muted small">Followers</div>
            </div>
            <div>
              <strong>{{ user.followingCount }}</strong>
              <div class="text-muted small">Following</div>
            </div>
          </div>

          <div *ngIf="!user.mine; else editTpl" class="d-grid gap-2">
            <button *ngIf="user.follow; else followTpl" class="btn btn-outline-secondary btn-sm"
              (click)="toggleFollow()">
              Unfollow
            </button>

            <ng-template #followTpl>
              <button class="btn btn-primary btn-sm" (click)="toggleFollow()">Follow</button>

              <button class="btn btn-light btn-sm text-danger" (click)="showReportSection()">
                Report
              </button>
            </ng-template>
          </div>

          <ng-template #editTpl>
            <button class="btn btn-outline-primary btn-sm w-100" (click)="showEditProfileComponent()">
              Edit Profile
            </button>
          </ng-template>
        </div>

        <ng-template #noUser>
          <div class="card-body text-center text-muted">No user yet</div>
        </ng-template>
      </div>
    </div>

    <div class="col-md-9">
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
          <h6 class="text-uppercase text-muted mb-2">Bio</h6>
          <p class="mb-0">
            {{ user.bio || 'Here is where the bio should be.' }}
          </p>
        </div>
      </div>

      <div *ngIf="!loading && user.posts != null">
        <div *ngFor="let post of user.posts" class="mb-4">
          <app-post [post]="post" [desc]="true" style="width: 100%"></app-post>
        </div>
      </div>

      <p *ngIf="!loading && user.posts.length === 0" class="text-muted text-center mt-5">
        No posts available.
      </p>
    </div>
  </div>
</div>

<app-report [visible]="showReport" [id]="user.id" [user]="true" (closed)="showReport = false"
  (reported)="handleReport($event)"></app-report>

<app-dialog [visible]="showDialog" [message]="dialogMessage" [title]="dialogTitle"
  (closed)="showDialog = false"></app-dialog>

<app-edit-profile [user]="user" [visible]="showEditProfile" (close)="showEditProfile = false" (saved)="onUserUpdated()">
</app-edit-profile>