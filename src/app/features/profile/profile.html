<app-header></app-header>

<div class="headerplace container mt-10">
  <div class="row g-4">
    <div class="col-md-3">
      <div class="card shadow-sm border-0 profile-card">
        @if (user.id != 0) {
        <div class="card-body text-center">
          <div class="avatar-wrapper mb-3">
            <img class="avatar-img"
              [src]="user.avatar?'http://localhost:8080/'+user.avatar:'https://bootdey.com/img/Content/avatar/avatar5.png'"
              alt="avatar" />
          </div>

          <h5 class="fw-bold mb-0">{{ user.username }}</h5>
          <span class="badge bg-secondary mb-2">{{ user.role }}</span>

          <p class="text-muted small mb-1">{{ user.email }}</p>
          <p class="text-muted small">Joined {{ user.CDate | timeAgo }}</p>

          <div class="d-flex justify-content-around my-3 stats">
            <div>
              <strong>{{ user.followersCount }}</strong>
              <div class="text-muted small">Followers</div>
            </div>
            <div>
              <strong>{{ user.followingCount }}</strong>
              <div class="text-muted small">Following</div>
            </div>
          </div>

          @if (user.id != 0 && !user.mine) {
          <div class="d-grid gap-2">
            @if (user.follow) {
            <button class="btn btn-outline-secondary btn-sm" (click)="toggleFollow()">
              Unfollow
            </button>
            } @else {
            <button class="btn btn-primary btn-sm" (click)="toggleFollow()">Follow</button>
            }
            <button class="btn btn-light btn-sm text-danger" (click)="showReportSection()">
              Report
            </button>
          </div>
          } @else {
          <button class="btn btn-outline-primary btn-sm w-100" (click)="showEditProfileComponent()">
            Edit Profile
          </button>
          }
        </div>
        }
      </div>
    </div>

    <div class="col-md-9">
      @if (user.id != 0){
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
          <h6 class="text-uppercase text-muted mb-2">Bio</h6>
          <p class="mb-0">
            {{ user.bio || 'Here is where the bio should be.' }}
          </p>
        </div>
      </div>
      }

      @if (user.id != 0 && !loading && user.posts != null) {
      <div>
        @for (post of user.posts; track $index) {
        <div class="mb-4">
          <app-post [post]="post" [desc]="true" style="width: 100%"></app-post>
        </div>
        }
      </div>
      }

      @if (user.id != 0 && !loading && user.posts.length === 0) {
      <p class="text-muted text-center mt-5">
        No posts available.
      </p>
      }
    </div>
  </div>
  @if (user.id == 0 && !loading) {
  <p class="text-muted text-center mt-5 pt-5">
    User not found.
  </p>
  }
</div>

<app-report [visible]="showReport" [id]="user.id" [user]="true" (closed)="showReport = false"
  (reported)="handleReport($event)"></app-report>

<app-dialog [visible]="showDialog" [message]="dialogMessage" [title]="dialogTitle"
  (closed)="showDialog = false"></app-dialog>

<app-edit-profile [user]="user" [visible]="showEditProfile" (close)="showEditProfile = false" (saved)="onUserUpdated()">
</app-edit-profile>